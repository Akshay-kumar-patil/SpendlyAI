<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voice Agent</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    font-family: Poppins, sans-serif;
    color: white;
    background: radial-gradient(circle at top, #0f172a, #020617);
}

.mic-btn {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    background: linear-gradient(135deg, #38bdf8, #6366f1);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    cursor: pointer;
    box-shadow: 0 0 40px rgba(99, 102, 241, 0.5);
}

.mic-btn.active {
    animation: pulse 1.3s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
}

.status-text {
    margin-top: 18px;
    font-size: 1.2rem;
    color: #d1d5db;
}

.result-box {
    width: 92%;
    max-width: 420px;
    margin-top: 25px;
    padding: 20px;
    border-radius: 20px;
    background: rgba(15, 23, 42, 0.6);
    display: none;
    flex-direction: column;
    gap: 12px;
}

.result-box.visible {
    display: flex;
}

input, button {
    padding: 12px;
    border-radius: 12px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.15);
    color: white;
    font-size: 1rem;
}

button {
    cursor: pointer;
    background: linear-gradient(135deg, #38bdf8, #6366f1);
}

.preview-text {
    color: #38bdf8;
    font-size: 0.95rem;
}
</style>
</head>

<body>

<h2>Speak Your Expense</h2>

<div class="mic-btn" id="micBtn">ðŸŽ¤</div>
<div class="status-text" id="status">Tap the mic to start</div>

<div class="result-box" id="resultBox">
    <div class="preview-text" id="spokenText"></div>

    <input id="amountField" placeholder="Amount">
    <input id="dateField" placeholder="Date">
    <input id="categoryField" placeholder="Category">

    <button id="saveBtn" type="button">Save Expense</button>
</div>

<script>
const micBtn = document.getElementById("micBtn");
const statusText = document.getElementById("status");
const resultBox = document.getElementById("resultBox");

const spokenText = document.getElementById("spokenText");
const amountField = document.getElementById("amountField");
const dateField = document.getElementById("dateField");
const categoryField = document.getElementById("categoryField");

micBtn.addEventListener("click", async () => {
    micBtn.classList.add("active");
    statusText.innerText = "Listening...";

    const res = await fetch("/run-voice-agent");
    const data = await res.json();

    micBtn.classList.remove("active");

    if (data.status === "success") {
        resultBox.classList.add("visible");
        statusText.innerText = "Review & Save";

        spokenText.innerText = "You said: " + data.sentence;
        amountField.value = data.amount;
        dateField.value = data.date;
        categoryField.value = data.category;
    } else {
        statusText.innerText = "Try again";
    }
});

document.getElementById("saveBtn").addEventListener("click", async () => {
    const payload = {
        amount: amountField.value,
        date: dateField.value,
        category: categoryField.value
    };

    const res = await fetch("/voice-agent", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.status === "success") {
        alert("Expense saved successfully âœ…");
        window.location.href = "/dashboard";
    } else {
        alert("Failed to save expense");
    }
});
</script>

</body>
</html>
